trigger:
  branches:
    include:
      - main

pool:
  name: Default
  # demands:
  #   - terraform

variables:
  TF_VERSION: '1.6.6'

stages:
  - stage: TerraformApply
    jobs:
      - job: Job
        steps:
          - checkout: self
            displayName: 'ğŸ” Checkout kawaiTakeru/terraform-subscription-test'

          - script: |
              echo "##[group]Step 1: Git clone"
              git clone https://github.com/kawaiTakeru/terraform-subscription-test.git
              cd terraform-subscription-test/terraform
              echo "##[endgroup]"

              echo "##[group]Step 2: terraform init"
              terraform init
              echo "##[endgroup]"

              echo "##[group]Step 3: terraform plan"
              terraform plan
              echo "##[endgroup]"

              echo "##[group]Step 4: terraform apply"
              terraform apply -auto-approve
              echo "##[endgroup]"

              echo "##[group]Step 5: å®Œäº† âœ…"
              echo "âœ… ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆæˆåŠŸ âœ…"
              echo "##[endgroup]"
            displayName: 'âš™ï¸ Run Terraform'
