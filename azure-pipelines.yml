trigger:
- main

pool:
  name: Default  # Self-hosted Agent の名前

steps:
- checkout: self

# 🔽 Dump CI Context 情報を表示（Function からの実行確認用）
- script: |
    echo "Build.SourceBranch: $(Build.SourceBranch)"
    echo "Build.Reason: $(Build.Reason)"
    echo "Build.RequestedFor: $(Build.RequestedFor)"
    echo "Build.RequestedForEmail: $(Build.RequestedForEmail)"
    echo "Build.TriggeredByBuildId: $(Build.TriggeredByBuildId)"
    echo "Agent.Name: $(Agent.Name)"
    echo "Agent.OS: $(Agent.OS)"
    echo "Agent.MachineName: $(Agent.MachineName)"
    echo "System.TeamProject: $(System.TeamProject)"
    echo "System.CollectionUri: $(System.CollectionUri)"
  displayName: '🔍 Show Pipeline Context'

# 🔽 Terraform 実行ステップ
- script: |
    cd terraform
    terraform init
    terraform plan
    terraform apply -auto-approve
  displayName: 'Run Terraform'

  